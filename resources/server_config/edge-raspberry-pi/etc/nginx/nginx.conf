worker_processes 4;
worker_rlimit_nofile 8192;

user www-data;
pid /var/run/nginx.pid;
error_log /var/log/nginx/error.log error;

events {
  multi_accept on;
  worker_connections 1024; # worker_processes * worker_connections = maxclients
}

## HTTP configuration

http {
#  include mime.types;
  include /etc/nginx/conf.d/*.http.conf;

  map_hash_bucket_size 128;
  default_type application/octet-stream;

  sendfile on;
  tcp_nopush on;
  keepalive_timeout 65;
  gzip off;

  ## Logs
  # Normal access log
  # access_log /var/log/nginx/access.log main;
  # Cache status logs
#  access_log /var/log/nginx/cache.log cache;
  access_log off;

  # Include site configuration files
  include /etc/nginx/sites-enabled/*;

} # http

## RTMP configuration

# Multi worker streaming
rtmp_auto_push on;
rtmp_auto_push_reconnect 1s;
rtmp_socket_dir /tmp;

rtmp {

  server {

    # Server IP address
    listen 1935;

    # Maximum chunk size for stream multiplexing. Default is 4096. The bigger this value the lower CPU overhead.
    chunk_size 4096;

    ping 30s;
    ping_timeout 10s;

    notify_method get;

    # Max connections to RTMP engine
    max_connections 200;

    wait_key on;
#    wait_video on;

    # Wowza PROD
    application vsqlive {
      live on;
      pull rtmp://vsq-stream.bonafarm.hu:1935/vsqlive;
      on_play http://vsq.bonafarm.hu/hu/live/checkstreamaccess;
    }

  } # server

} # rtmp
