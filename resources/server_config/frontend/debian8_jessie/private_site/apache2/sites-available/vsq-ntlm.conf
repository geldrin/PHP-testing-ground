<VirtualHost vsq.bonafarm.hu:80>
    DocumentRoot /var/www/videosquare.eu/httpdocs
    ServerName vsq.bonafarm.hu
    ServerAdmin support@videosqr.com

#    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9000/var/www/videosquare.eu/httpdocs/$1

    RewriteEngine On
    RewriteRule ^/[a-z]{2,4}/contents - [E=no_auth_required:1]
    RewriteRule ^/[a-z]{2,4}/combine - [E=no_auth_required:1]
    RewriteRule ^/([a-z]{2,4}/)?(recordings|live)/(secure)?checkstreamaccess - [E=no_auth_required:1]
    RewriteRule ^/[a-z]{2,4}/api - [E=no_auth_required:1]
#    RewriteRule ^/[a-z]{2,4}/a2143 - [E=no_auth_required:1]
# force basic auth: pmya? munin? a2143?

#RewriteRule "\.(png|gif|jpg)$" "-" [E=image:1]

    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>

    <Directory /var/www/videosquare.eu/httpdocs>

        Options Indexes FollowSymLinks
        AllowOverride All
#        Order allow,deny

        # if no_auth_required = 1 then allow
#        Allow from env=no_auth_required
#        Satisfy any

        AddHandler mod_python .py

        # Debug log using mod_debug_log: print no authentication environment variable
#        LogMessage "URL: %{REQUEST_URI} | ENV no_auth_required: %{reqenv:no_auth_required} | " hook=all

# http://www.the-art-of-web.com/system/apache-authorization/

        # Authentication
        <RequireAny>

            # Allow local request (e.g. combine)
            <RequireAny>
                Require ip 127.0.0.1
                # Front-end IP addresses
                Require ip 10.10.3.171
                Require ip 10.10.3.172
                Require ip 10.10.3.173
                # vsq-conv.bonafarm.hu
                Require ip 10.10.3.174
            </RequireAny>

            # Allow specific URLs with no authentication
            <RequireAll>
                Require env no_auth_required
                Require all granted
            </RequireAll>

            # NTLM authentication
            <RequireAll>

#AuthType Basic
#AuthName "Password Protected"
#AuthUserFile /etc/apache2/vsq.htpasswd

                # NTLM SSO config
                AuthType NTLM
                AuthName "Bonafarm Authentication"
                PythonOption Require valid-user

                PythonHandler mod_python.publisher
                PythonAuthenHandler pyntlm
                PythonOption Domain BONAFARM.GROUP
                PythonOption PDC gcbysvv28adc001
                PythonOption BDC bybysvv28adc001
                # SAM or LogOn
                #PythonOption NameFmt SAM

                PythonDebug On

                Require valid-user

            </RequireAll>

        </RequireAny>

    </Directory>

    #LogLevel alert rewrite:trace5
    LogLevel info
    ErrorLog ${APACHE_LOG_DIR}/vsq.bonafarm.hu-error.log
    CustomLog ${APACHE_LOG_DIR}/vsq.bonafarm.hu-access.log combined

</VirtualHost>

#<IfModule mod_ssl.c>
#<VirtualHost 10.10.3.171:443>
#    DocumentRoot /var/www/videosquare.eu/httpdocs
#    ServerName vsq.bonafarm.hu
#    ServerAdmin support@videosqr.com
#
#    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9000/var/www/videosquare.eu/httpdocs/$1
#
#    <Directory /var/www/videosquare.eu/httpdocs>
#      Options Indexes FollowSymLinks MultiViews
#      AllowOverride All
#      Order allow,deny
#      Allow from all
#      Require all granted
#    </Directory>
#
#    LogLevel warn
#    ErrorLog ${APACHE_LOG_DIR}/vsq.bonafarm.hu-ssl-error.log
#    CustomLog ${APACHE_LOG_DIR}/vsq.bonafarm.hu-ssl-access.log combined
#
#    SSLEngine Off
#    SSLProtocol All -SSLv2 -SSLv3
#    SSLHonorCipherOrder On
#    SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
#
#    SSLCertificateFile /etc/apache2/certs/vsqdev-selfsigned.crt
#    SSLCertificateKeyFile /etc/apache2/certs/vsqdev-selfsigned.key
##    SSLCACertificateFile /etc/apache2/certs/startssl-ca-sha2.crt
##    SSLCertificateChainFile /etc/apache2/certs/startssl-certs-class2.crt
#
#</VirtualHost>
#</IfModule>
